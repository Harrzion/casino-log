<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="theme-color" content="#0a0a0f">
<title>Casino Log</title>
<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=DM+Sans:ital,wght@0,300;0,400;0,500;0,600;1,400&display=swap" rel="stylesheet">
<style>
  :root {
    --bg: #0a0a0f;
    --surface: #13131a;
    --surface2: #1c1c27;
    --border: #2a2a3a;
    --gold: #f5c842;
    --green: #2dce6e;
    --red: #ff4d6d;
    --text: #f0f0f5;
    --text-dim: #7a7a9a;
    --radius: 16px;
  }
  * { box-sizing: border-box; margin: 0; padding: 0; -webkit-tap-highlight-color: transparent; }
  body {
    font-family: 'DM Sans', sans-serif;
    background: var(--bg);
    color: var(--text);
    min-height: 100vh;
    max-width: 480px;
    margin: 0 auto;
    padding-bottom: 60px;
  }

  /* HEADER */
  .header {
    padding: 52px 24px 20px;
    background: linear-gradient(180deg, #13131a 0%, transparent 100%);
    position: relative; overflow: hidden;
  }
  .header::before {
    content: 'üé∞'; position: absolute; right: -10px; top: 10px;
    font-size: 110px; opacity: 0.07; transform: rotate(-10deg); pointer-events: none;
  }
  .header-label { font-family: 'Bebas Neue', sans-serif; font-size: 11px; letter-spacing: 4px; color: var(--gold); margin-bottom: 4px; }
  .header-title { font-family: 'Bebas Neue', sans-serif; font-size: 42px; letter-spacing: 2px; line-height: 1; }
  .header-title span { color: var(--gold); }

  /* STATS */
  .stats-bar { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; padding: 0 20px 20px; }
  .stat-card { background: var(--surface); border: 1px solid var(--border); border-radius: 12px; padding: 12px 10px; text-align: center; }
  .stat-label { font-size: 9px; letter-spacing: 2px; color: var(--text-dim); text-transform: uppercase; margin-bottom: 4px; }
  .stat-value { font-family: 'Bebas Neue', sans-serif; font-size: 22px; letter-spacing: 1px; }
  .stat-value.positive { color: var(--green); }
  .stat-value.negative { color: var(--red); }
  .stat-value.neutral { color: var(--gold); }

  /* ADD BUTTON */
  .add-btn {
    display: flex; align-items: center; justify-content: center; gap: 10px;
    margin: 0 20px 20px; padding: 18px;
    background: var(--gold); color: #0a0a0f;
    border: none; border-radius: var(--radius);
    font-family: 'DM Sans', sans-serif; font-size: 16px; font-weight: 600;
    cursor: pointer; width: calc(100% - 40px);
    box-shadow: 0 8px 32px rgba(245,200,66,0.25); transition: all 0.2s;
  }
  .add-btn:active { transform: scale(0.97); }

  /* SEARCH & FILTER */
  .search-filter { padding: 0 20px 16px; display: flex; flex-direction: column; gap: 10px; }
  .search-box {
    display: flex; align-items: center; gap: 10px;
    background: var(--surface); border: 1px solid var(--border); border-radius: 12px;
    padding: 12px 14px; transition: border-color 0.2s;
  }
  .search-box:focus-within { border-color: var(--gold); }
  .search-icon { width: 16px; height: 16px; color: var(--text-dim); flex-shrink: 0; }
  .search-box input {
    background: none; border: none; outline: none;
    color: var(--text); font-family: 'DM Sans', sans-serif; font-size: 15px; width: 100%;
  }
  .search-box input::placeholder { color: var(--text-dim); }
  .clear-search {
    background: none; border: none; color: var(--text-dim); cursor: pointer;
    font-size: 18px; padding: 0 2px; display: none;
  }

  .filter-row { display: flex; gap: 8px; overflow-x: auto; padding-bottom: 2px; scrollbar-width: none; }
  .filter-row::-webkit-scrollbar { display: none; }
  .filter-chip {
    flex-shrink: 0; padding: 7px 14px;
    background: var(--surface); border: 1px solid var(--border); border-radius: 100px;
    color: var(--text-dim); font-size: 12px; font-family: 'DM Sans', sans-serif; font-weight: 500;
    cursor: pointer; transition: all 0.2s; white-space: nowrap;
  }
  .filter-chip.active { background: var(--gold); border-color: var(--gold); color: #0a0a0f; }
  .filter-chip:active { transform: scale(0.95); }

  .sort-row { display: flex; gap: 8px; align-items: center; }
  .sort-label { font-size: 11px; color: var(--text-dim); letter-spacing: 1px; text-transform: uppercase; flex-shrink: 0; }
  .sort-select {
    flex: 1; padding: 8px 12px;
    background: var(--surface); border: 1px solid var(--border); border-radius: 10px;
    color: var(--text); font-family: 'DM Sans', sans-serif; font-size: 13px;
    cursor: pointer; outline: none;
  }
  .sort-select:focus { border-color: var(--gold); }

  /* RESULTS COUNT */
  .results-count { padding: 0 20px 10px; font-size: 11px; letter-spacing: 2px; color: var(--text-dim); text-transform: uppercase; }

  /* ENTRY CARDS */
  .entries-list { padding: 0 20px; display: flex; flex-direction: column; gap: 10px; }
  .entry-card {
    background: var(--surface); border: 1px solid var(--border); border-radius: var(--radius);
    padding: 14px 16px; animation: slideIn 0.25s ease;
    position: relative; overflow: hidden;
  }
  @keyframes slideIn { from { opacity: 0; transform: translateY(8px); } to { opacity: 1; transform: translateY(0); } }
  .entry-card.win { border-left: 3px solid var(--green); }
  .entry-card.loss { border-left: 3px solid var(--red); }
  .entry-card.push { border-left: 3px solid var(--text-dim); }

  .entry-top { display: flex; justify-content: space-between; align-items: flex-start; gap: 8px; }
  .entry-left { flex: 1; min-width: 0; }
  .entry-location { font-size: 15px; font-weight: 600; color: var(--text); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
  .entry-meta { font-size: 11px; color: var(--text-dim); margin-top: 3px; }
  .entry-notes { font-size: 12px; color: var(--text-dim); margin-top: 6px; font-style: italic; }

  .entry-right { display: flex; flex-direction: column; align-items: flex-end; gap: 6px; flex-shrink: 0; }
  .entry-amount { font-family: 'Bebas Neue', sans-serif; font-size: 28px; letter-spacing: 1px; line-height: 1; }
  .entry-amount.positive { color: var(--green); }
  .entry-amount.negative { color: var(--red); }
  .entry-amount.zero { color: var(--text-dim); }

  .entry-actions { display: flex; gap: 6px; }
  .entry-btn {
    padding: 5px 10px; border-radius: 8px; font-size: 11px; font-weight: 600;
    font-family: 'DM Sans', sans-serif; cursor: pointer; border: 1px solid; transition: all 0.15s;
  }
  .edit-btn { background: transparent; border-color: var(--border); color: var(--text-dim); }
  .edit-btn:active { background: var(--border); }
  .delete-btn { background: transparent; border-color: rgba(255,77,109,0.3); color: var(--red); }
  .delete-btn:active { background: rgba(255,77,109,0.15); }

  /* EMPTY STATE */
  .empty-state { text-align: center; padding: 50px 20px; color: var(--text-dim); }
  .empty-state .big-emoji { font-size: 52px; display: block; margin-bottom: 14px; }
  .empty-state p { font-size: 14px; line-height: 1.7; }

  /* MODAL */
  .modal-overlay {
    position: fixed; inset: 0;
    background: rgba(0,0,0,0.8); backdrop-filter: blur(6px);
    z-index: 100; display: flex; align-items: flex-end;
    opacity: 0; pointer-events: none; transition: opacity 0.25s;
  }
  .modal-overlay.open { opacity: 1; pointer-events: all; }
  .modal {
    background: var(--surface); border-radius: 24px 24px 0 0;
    padding: 24px 24px 48px; width: 100%; max-width: 480px; margin: 0 auto;
    transform: translateY(100%); transition: transform 0.3s cubic-bezier(0.34,1.4,0.64,1);
    max-height: 94vh; overflow-y: auto;
  }
  .modal-overlay.open .modal { transform: translateY(0); }
  .modal-handle { width: 40px; height: 4px; background: var(--border); border-radius: 2px; margin: 0 auto 22px; }
  .modal-title { font-family: 'Bebas Neue', sans-serif; font-size: 28px; letter-spacing: 2px; margin-bottom: 22px; }
  .modal-title span { color: var(--gold); }

  /* FORM */
  .form-group { margin-bottom: 14px; }
  .form-label { display: block; font-size: 11px; letter-spacing: 2px; color: var(--text-dim); text-transform: uppercase; margin-bottom: 7px; }
  .form-input {
    width: 100%; padding: 14px 16px;
    background: var(--surface2); border: 1px solid var(--border); border-radius: 12px;
    color: var(--text); font-size: 16px; font-family: 'DM Sans', sans-serif;
    transition: border-color 0.2s; -webkit-appearance: none;
  }
  .form-input:focus { outline: none; border-color: var(--gold); background: #1e1e2a; }
  .form-input::placeholder { color: var(--text-dim); }
  .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }

  /* P/L PREVIEW */
  .pl-preview {
    background: var(--surface2); border: 1px solid var(--border); border-radius: 12px;
    padding: 14px 18px; margin-bottom: 18px;
    display: flex; justify-content: space-between; align-items: center;
  }
  .pl-preview-label { font-size: 11px; letter-spacing: 2px; color: var(--text-dim); text-transform: uppercase; }
  .pl-preview-value { font-family: 'Bebas Neue', sans-serif; font-size: 34px; letter-spacing: 1px; transition: color 0.2s; }
  .pl-preview-value.positive { color: var(--green); }
  .pl-preview-value.negative { color: var(--red); }
  .pl-preview-value.zero { color: var(--text-dim); }

  .submit-btn {
    width: 100%; padding: 18px;
    background: var(--gold); color: #0a0a0f;
    border: none; border-radius: var(--radius);
    font-family: 'DM Sans', sans-serif; font-size: 16px; font-weight: 700;
    cursor: pointer; transition: all 0.2s;
  }
  .submit-btn:active { transform: scale(0.97); }
  .cancel-btn {
    width: 100%; padding: 14px; margin-top: 10px;
    background: transparent; border: 1px solid var(--border); border-radius: var(--radius);
    color: var(--text-dim); font-family: 'DM Sans', sans-serif; font-size: 15px; cursor: pointer;
  }
  .cancel-btn:active { background: var(--surface2); }

  /* CONFIRM DELETE MODAL */
  .confirm-overlay {
    position: fixed; inset: 0;
    background: rgba(0,0,0,0.85); backdrop-filter: blur(8px);
    z-index: 200; display: flex; align-items: center; justify-content: center;
    opacity: 0; pointer-events: none; transition: opacity 0.2s;
    padding: 24px;
  }
  .confirm-overlay.open { opacity: 1; pointer-events: all; }
  .confirm-box {
    background: var(--surface); border: 1px solid var(--border); border-radius: 20px;
    padding: 28px 24px; width: 100%; max-width: 340px;
    transform: scale(0.9); transition: transform 0.25s cubic-bezier(0.34,1.4,0.64,1);
    text-align: center;
  }
  .confirm-overlay.open .confirm-box { transform: scale(1); }
  .confirm-emoji { font-size: 40px; display: block; margin-bottom: 14px; }
  .confirm-title { font-family: 'Bebas Neue', sans-serif; font-size: 24px; letter-spacing: 1px; margin-bottom: 8px; }
  .confirm-sub { font-size: 13px; color: var(--text-dim); margin-bottom: 22px; line-height: 1.5; }
  .confirm-entry-name { color: var(--text); font-weight: 600; }
  .confirm-btns { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
  .confirm-cancel { padding: 13px; background: var(--surface2); border: 1px solid var(--border); border-radius: 12px; color: var(--text-dim); font-family: 'DM Sans', sans-serif; font-size: 14px; font-weight: 500; cursor: pointer; }
  .confirm-delete { padding: 13px; background: var(--red); border: none; border-radius: 12px; color: white; font-family: 'DM Sans', sans-serif; font-size: 14px; font-weight: 700; cursor: pointer; }
  .confirm-delete:active { opacity: 0.85; }

  /* TOAST */
  .toast {
    position: fixed; bottom: 30px; left: 50%;
    transform: translateX(-50%) translateY(80px);
    background: var(--surface2); border: 1px solid var(--border);
    border-radius: 100px; padding: 12px 24px;
    font-size: 14px; font-weight: 500; color: var(--text);
    z-index: 300; transition: transform 0.3s cubic-bezier(0.34,1.4,0.64,1);
    white-space: nowrap;
  }
  .toast.show { transform: translateX(-50%) translateY(0); }
  .toast.success { border-color: var(--green); color: var(--green); }
  .toast.error { border-color: var(--red); color: var(--red); }
</style>
</head>
<body>

<!-- Header -->
<div class="header">
  <div class="header-label">Personal Tracker</div>
  <div class="header-title">Casino<span>Log</span></div>
</div>

<!-- Stats -->
<div class="stats-bar">
  <div class="stat-card">
    <div class="stat-label">All Time</div>
    <div class="stat-value neutral" id="stat-alltime">$0</div>
  </div>
  <div class="stat-card">
    <div class="stat-label">Sessions</div>
    <div class="stat-value neutral" id="stat-sessions">0</div>
  </div>
  <div class="stat-card">
    <div class="stat-label">Win Rate</div>
    <div class="stat-value neutral" id="stat-winrate">‚Äî</div>
  </div>
</div>

<!-- Add Button -->
<button class="add-btn" onclick="openModal()">
  <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
  New Entry
</button>

<!-- Search & Filter -->
<div class="search-filter">
  <div class="search-box">
    <svg class="search-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>
    <input type="text" id="search-input" placeholder="Search location, game, notes..." oninput="handleSearch(this.value)" />
    <button class="clear-search" id="clear-search-btn" onclick="clearSearch()">‚úï</button>
  </div>

  <div class="filter-row" id="filter-row">
    <button class="filter-chip active" data-filter="all" onclick="setFilter('all', this)">All</button>
    <button class="filter-chip" data-filter="wins" onclick="setFilter('wins', this)">Wins Only</button>
    <button class="filter-chip" data-filter="losses" onclick="setFilter('losses', this)">Losses Only</button>
    <!-- Month chips injected dynamically -->
  </div>

  <div class="sort-row">
    <span class="sort-label">Sort</span>
    <select class="sort-select" id="sort-select" onchange="renderEntries()">
      <option value="newest">Newest First</option>
      <option value="oldest">Oldest First</option>
      <option value="most-won">Most Won</option>
      <option value="most-lost">Most Lost</option>
      <option value="biggest">Biggest Swing</option>
    </select>
  </div>
</div>

<div class="results-count" id="results-count"></div>
<div class="entries-list" id="entries-list"></div>

<!-- Entry Modal (Add / Edit) -->
<div class="modal-overlay" id="modal-overlay" onclick="handleOverlayClick(event)">
  <div class="modal">
    <div class="modal-handle"></div>
    <div class="modal-title" id="modal-title">New <span>Entry</span></div>

    <div class="form-group">
      <label class="form-label">Site / Location *</label>
      <input class="form-input" id="f-location" type="text" placeholder="e.g. Cimmeron, Yotta Online..." autocomplete="off" />
    </div>
    <div class="form-group">
      <label class="form-label">Date *</label>
      <input class="form-input" id="f-date" type="date" />
    </div>
    <div class="form-row">
      <div class="form-group">
        <label class="form-label">Buy-In ($)</label>
        <input class="form-input" id="f-buyin" type="number" inputmode="decimal" placeholder="0.00" step="0.01" min="0" oninput="updatePreview()" />
      </div>
      <div class="form-group">
        <label class="form-label">Redeemed ($)</label>
        <input class="form-input" id="f-redeemed" type="number" inputmode="decimal" placeholder="0.00" step="0.01" min="0" oninput="updatePreview()" />
      </div>
    </div>
    <div class="form-group">
      <label class="form-label">Redemption Fee ($) <span style="color:var(--text-dim);font-size:10px;">optional</span></label>
      <input class="form-input" id="f-fee" type="number" inputmode="decimal" placeholder="0.00" step="0.01" min="0" oninput="updatePreview()" />
    </div>
    <div class="form-group">
      <label class="form-label">Game Type <span style="color:var(--text-dim);font-size:10px;">optional</span></label>
      <input class="form-input" id="f-game" type="text" placeholder="e.g. Slots, Blackjack, Craps..." autocomplete="off" />
    </div>
    <div class="form-group">
      <label class="form-label">Notes <span style="color:var(--text-dim);font-size:10px;">optional</span></label>
      <input class="form-input" id="f-notes" type="text" placeholder="Who were you with? Any details..." autocomplete="off" />
    </div>

    <div class="pl-preview">
      <div class="pl-preview-label">Profit / Loss</div>
      <div class="pl-preview-value zero" id="pl-preview">$0</div>
    </div>

    <button class="submit-btn" id="submit-btn" onclick="submitEntry()">Log Entry</button>
    <button class="cancel-btn" onclick="closeModal()">Cancel</button>
  </div>
</div>

<!-- Confirm Delete Modal -->
<div class="confirm-overlay" id="confirm-overlay">
  <div class="confirm-box">
    <span class="confirm-emoji">üóëÔ∏è</span>
    <div class="confirm-title">Delete Entry?</div>
    <div class="confirm-sub">This will permanently delete <span class="confirm-entry-name" id="confirm-entry-name"></span>. This can't be undone.</div>
    <div class="confirm-btns">
      <button class="confirm-cancel" onclick="closeConfirm()">Cancel</button>
      <button class="confirm-delete" onclick="confirmDelete()">Delete</button>
    </div>
  </div>
</div>

<!-- Toast -->
<div class="toast" id="toast"></div>

<script>
  // ‚îÄ‚îÄ State ‚îÄ‚îÄ
  let entries = JSON.parse(localStorage.getItem('casinoEntries') || '[]');
  let activeFilter = 'all';
  let searchQuery = '';
  let editingId = null;
  let deletingId = null;

  // ‚îÄ‚îÄ Init ‚îÄ‚îÄ
  setDefaultDate();
  renderEntries();
  updateStats();
  buildMonthFilters();

  function setDefaultDate() {
    const today = new Date().toISOString().split('T')[0];
    document.getElementById('f-date').value = today;
  }

  // ‚îÄ‚îÄ Build month/year filter chips ‚îÄ‚îÄ
  function buildMonthFilters() {
    const row = document.getElementById('filter-row');
    // Remove old dynamic chips
    row.querySelectorAll('[data-dynamic]').forEach(el => el.remove());

    // Get unique year-months from entries
    const seen = new Set();
    const months = [];
    [...entries].sort((a,b) => new Date(b.date) - new Date(a.date)).forEach(e => {
      const d = new Date(e.date);
      if (isNaN(d)) return;
      const key = `${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,'0')}`;
      if (!seen.has(key)) { seen.add(key); months.push({ key, d }); }
    });

    // Get unique years
    const years = [...new Set(months.map(m => m.d.getFullYear()))];
    years.forEach(y => {
      const btn = document.createElement('button');
      btn.className = 'filter-chip';
      btn.dataset.filter = `year-${y}`;
      btn.dataset.dynamic = '1';
      btn.textContent = y;
      btn.onclick = function() { setFilter(`year-${y}`, this); };
      row.appendChild(btn);
    });

    months.forEach(({ key, d }) => {
      const btn = document.createElement('button');
      btn.className = 'filter-chip';
      btn.dataset.filter = `month-${key}`;
      btn.dataset.dynamic = '1';
      btn.textContent = d.toLocaleDateString('en-US', { month: 'short', year: '2-digit' });
      btn.onclick = function() { setFilter(`month-${key}`, this); };
      row.appendChild(btn);
    });
  }

  function setFilter(filter, el) {
    activeFilter = filter;
    document.querySelectorAll('.filter-chip').forEach(c => c.classList.remove('active'));
    el.classList.add('active');
    renderEntries();
  }

  function handleSearch(val) {
    searchQuery = val.trim().toLowerCase();
    document.getElementById('clear-search-btn').style.display = val ? 'block' : 'none';
    renderEntries();
  }

  function clearSearch() {
    document.getElementById('search-input').value = '';
    document.getElementById('clear-search-btn').style.display = 'none';
    searchQuery = '';
    renderEntries();
  }

  // ‚îÄ‚îÄ Filter + Sort ‚îÄ‚îÄ
  function getFilteredSorted() {
    let list = [...entries];

    // Search
    if (searchQuery) {
      list = list.filter(e =>
        (e.location || '').toLowerCase().includes(searchQuery) ||
        (e.notes || '').toLowerCase().includes(searchQuery) ||
        (e.game || '').toLowerCase().includes(searchQuery)
      );
    }

    // Filter chips
    if (activeFilter === 'wins') list = list.filter(e => e.pl > 0);
    else if (activeFilter === 'losses') list = list.filter(e => e.pl < 0);
    else if (activeFilter.startsWith('year-')) {
      const y = parseInt(activeFilter.split('-')[1]);
      list = list.filter(e => { const d = new Date(e.date); return !isNaN(d) && d.getFullYear() === y; });
    } else if (activeFilter.startsWith('month-')) {
      const key = activeFilter.replace('month-', '');
      list = list.filter(e => {
        const d = new Date(e.date);
        if (isNaN(d)) return false;
        const k = `${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,'0')}`;
        return k === key;
      });
    }

    // Sort
    const sort = document.getElementById('sort-select').value;
    if (sort === 'newest') list.sort((a,b) => new Date(b.date) - new Date(a.date) || b.id - a.id);
    else if (sort === 'oldest') list.sort((a,b) => new Date(a.date) - new Date(b.date) || a.id - b.id);
    else if (sort === 'most-won') list.sort((a,b) => b.pl - a.pl);
    else if (sort === 'most-lost') list.sort((a,b) => a.pl - b.pl);
    else if (sort === 'biggest') list.sort((a,b) => Math.abs(b.pl) - Math.abs(a.pl));

    return list;
  }

  // ‚îÄ‚îÄ Render ‚îÄ‚îÄ
  function renderEntries() {
    const list = getFilteredSorted();
    const container = document.getElementById('entries-list');
    const countEl = document.getElementById('results-count');

    // Results count
    if (searchQuery || activeFilter !== 'all') {
      const total = entries.length;
      countEl.textContent = `${list.length} of ${total} entries`;
    } else {
      countEl.textContent = entries.length > 0 ? `${entries.length} entries` : '';
    }

    if (list.length === 0) {
      const msg = searchQuery || activeFilter !== 'all'
        ? `<div class="empty-state"><span class="big-emoji">üîç</span><p>No entries match your search or filter.<br>Try something else!</p></div>`
        : `<div class="empty-state"><span class="big-emoji">üé≤</span><p>No entries yet.<br>Hit <strong>New Entry</strong> to log your first session!</p></div>`;
      container.innerHTML = msg;
      return;
    }

    container.innerHTML = list.map(e => {
      const cls = e.pl > 0 ? 'win' : e.pl < 0 ? 'loss' : 'push';
      const amtCls = e.pl > 0 ? 'positive' : e.pl < 0 ? 'negative' : 'zero';
      const dateStr = e.date ? new Date(e.date + 'T12:00:00').toLocaleDateString('en-US', {month:'short', day:'numeric', year:'numeric'}) : '';
      const meta = [dateStr, e.game].filter(Boolean).join(' ¬∑ ');
      const buyInfo = e.buyin > 0 ? `In: $${e.buyin}  ‚Üí  Out: $${e.redeemed || 0}` : '';
      return `<div class="entry-card ${cls}" id="card-${e.id}">
        <div class="entry-top">
          <div class="entry-left">
            <div class="entry-location">${e.location}</div>
            <div class="entry-meta">${meta}${buyInfo ? '<br>' + buyInfo : ''}</div>
            ${e.notes ? `<div class="entry-notes">${e.notes}</div>` : ''}
          </div>
          <div class="entry-right">
            <div class="entry-amount ${amtCls}">${formatMoney(e.pl)}</div>
            <div class="entry-actions">
              <button class="entry-btn edit-btn" onclick="openEdit(${e.id})">Edit</button>
              <button class="entry-btn delete-btn" onclick="openConfirmDelete(${e.id})">Delete</button>
            </div>
          </div>
        </div>
      </div>`;
    }).join('');
  }

  function updateStats() {
    const total = entries.reduce((s,e) => s + e.pl, 0);
    const wins = entries.filter(e => e.pl > 0).length;
    const rate = entries.length > 0 ? Math.round((wins / entries.length) * 100) : null;

    const el = document.getElementById('stat-alltime');
    el.textContent = formatMoney(total);
    el.className = 'stat-value ' + (total > 0 ? 'positive' : total < 0 ? 'negative' : 'neutral');
    document.getElementById('stat-sessions').textContent = entries.length;
    document.getElementById('stat-winrate').textContent = rate !== null ? rate + '%' : '‚Äî';
  }

  // ‚îÄ‚îÄ Modal Open/Close ‚îÄ‚îÄ
  function openModal() {
    editingId = null;
    document.getElementById('modal-title').innerHTML = 'New <span>Entry</span>';
    document.getElementById('submit-btn').textContent = 'Log Entry';
    clearForm();
    setDefaultDate();
    document.getElementById('modal-overlay').classList.add('open');
    setTimeout(() => document.getElementById('f-location').focus(), 350);
  }

  function openEdit(id) {
    const entry = entries.find(e => e.id === id);
    if (!entry) return;
    editingId = id;
    document.getElementById('modal-title').innerHTML = 'Edit <span>Entry</span>';
    document.getElementById('submit-btn').textContent = 'Save Changes';
    document.getElementById('f-location').value = entry.location || '';
    document.getElementById('f-date').value = entry.date || '';
    document.getElementById('f-buyin').value = entry.buyin || '';
    document.getElementById('f-redeemed').value = entry.redeemed || '';
    document.getElementById('f-fee').value = entry.fee || '';
    document.getElementById('f-game').value = entry.game || '';
    document.getElementById('f-notes').value = entry.notes || '';
    updatePreview();
    document.getElementById('modal-overlay').classList.add('open');
  }

  function closeModal() {
    document.getElementById('modal-overlay').classList.remove('open');
    editingId = null;
    clearForm();
  }

  function handleOverlayClick(e) {
    if (e.target === document.getElementById('modal-overlay')) closeModal();
  }

  function clearForm() {
    ['f-location','f-buyin','f-redeemed','f-fee','f-game','f-notes'].forEach(id => {
      document.getElementById(id).value = '';
    });
    updatePreview();
  }

  // ‚îÄ‚îÄ P/L Preview ‚îÄ‚îÄ
  function updatePreview() {
    const buyin    = parseFloat(document.getElementById('f-buyin').value)    || 0;
    const redeemed = parseFloat(document.getElementById('f-redeemed').value) || 0;
    const fee      = parseFloat(document.getElementById('f-fee').value)      || 0;
    const pl = redeemed - buyin - fee;
    const el = document.getElementById('pl-preview');
    el.textContent = formatMoney(pl);
    el.className = 'pl-preview-value ' + (pl > 0 ? 'positive' : pl < 0 ? 'negative' : 'zero');
  }

  // ‚îÄ‚îÄ Submit (Add or Edit) ‚îÄ‚îÄ
  function submitEntry() {
    const location = document.getElementById('f-location').value.trim();
    if (!location) { showToast('Location is required', 'error'); return; }

    const buyin    = parseFloat(document.getElementById('f-buyin').value)    || 0;
    const redeemed = parseFloat(document.getElementById('f-redeemed').value) || 0;
    const fee      = parseFloat(document.getElementById('f-fee').value)      || 0;
    const game     = document.getElementById('f-game').value.trim();
    const notes    = document.getElementById('f-notes').value.trim();
    const date     = document.getElementById('f-date').value;
    const pl       = redeemed - buyin - fee;

    if (editingId !== null) {
      // Edit existing
      const idx = entries.findIndex(e => e.id === editingId);
      if (idx !== -1) {
        entries[idx] = { ...entries[idx], location, date, buyin, redeemed, fee, game, notes, pl };
        save();
        closeModal();
        showToast('‚úÖ Entry updated!', 'success');
      }
    } else {
      // New entry
      const entry = { id: Date.now(), location, date, buyin, redeemed, fee, game, notes, pl };
      entries.unshift(entry);
      save();
      closeModal();
      showToast('‚úÖ Entry logged!', 'success');
    }
  }

  // ‚îÄ‚îÄ Delete ‚îÄ‚îÄ
  function openConfirmDelete(id) {
    const entry = entries.find(e => e.id === id);
    if (!entry) return;
    deletingId = id;
    document.getElementById('confirm-entry-name').textContent = `"${entry.location}"`;
    document.getElementById('confirm-overlay').classList.add('open');
  }

  function closeConfirm() {
    document.getElementById('confirm-overlay').classList.remove('open');
    deletingId = null;
  }

  function confirmDelete() {
    if (deletingId === null) return;
    entries = entries.filter(e => e.id !== deletingId);
    save();
    closeConfirm();
    showToast('üóëÔ∏è Entry deleted', '');
  }

  // ‚îÄ‚îÄ Save ‚îÄ‚îÄ
  function save() {
    localStorage.setItem('casinoEntries', JSON.stringify(entries));
    renderEntries();
    updateStats();
    buildMonthFilters();
  }

  // ‚îÄ‚îÄ Helpers ‚îÄ‚îÄ
  function formatMoney(n) {
    const abs = Math.abs(n);
    const str = abs % 1 === 0
      ? abs.toLocaleString('en-US')
      : abs.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
    return (n < 0 ? '-' : n > 0 ? '+' : '') + '$' + str;
  }

  function showToast(msg, type='') {
    const t = document.getElementById('toast');
    t.textContent = msg;
    t.className = 'toast show ' + type;
    setTimeout(() => { t.className = 'toast ' + type; }, 3000);
  }
</script>
</body>
</html>
